<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.dromara.im.mapper.MsgRecordMapper">

    <resultMap id="MsgRecordOneSimpleUser" type="org.dromara.im.domain.vo.MsgRecordVo">
        <result property="id" column="id"/>
        <result property="senderId" column="sender_id"/>
        <result property="toId" column="to_id"/>
        <result property="toGroupId" column="to_group_id"/>
        <result property="toAppId" column="to_app_id"/>
        <result property="content" column="content" />
        <result property="msgType" column="msg_type"/>
        <result property="toType" column="to_type"/>
        <result property="status" column="status"/>
        <result property="unread" column="unread"/>
        <result property="refMsgId" column="ref_msg_id"/>
        <result property="remark" column="remark"/>
        <result property="createTime" column="create_time"/>
        <association property="author"  column="user_id" javaType="org.dromara.im.domain.SimpleUser">
            <result property="nickName" column="nick_name"/>
            <result property="userName" column="user_name"/>
            <result property="userId" column="user_id"/>
            <result property="userType" column="user_type"/>
            <result property="avatar" column="avatar" />
        </association>
        <association property="action" column="action_id" javaType="org.dromara.im.domain.vo.MsgActionVo">
            <result property="fullCount" column="full_count"/>
            <result property="likeCount" column="like_count"/>
            <result property="endorseCount" column="endorse_count"/>
        </association>
    </resultMap>

    <sql id="sql1">
            imr.id,
            imr.sender_id,
               imr.to_id,
               imr.to_group_id,
               imr.to_app_id,
               imr.content,
               imr.msg_type,
               imr.to_type,
               imr.status,
               imr.unread,
               imr.ref_msg_id,
               imr.create_time,
               imr.remark,
               su.nick_name,
               su.user_name,
               su.user_id,
               su.user_type,
               so.url as avatar,
               ima.id as action_id,
               ima.full_count,
               ima.like_count,
               ima.endorse_count
        from im_msg_record imr
                 left join im_msg_action ima on ima.msg_id = imr.id
                 left join sys_user su on su.user_id = imr.sender_id
                 left join sys_oss so on su.avatar = so.oss_id

    </sql>

    <select id="queryUsersOneOnOneChatHistoryWithFriends" resultMap="MsgRecordOneSimpleUser">
        select <include refid="sql1" /> ${ew.getCustomSqlSegment}
    </select>
    <select id="queryChatRecordsOfUserGroupChats" resultMap="MsgRecordOneSimpleUser">
        select <include refid="sql1" /> ${ew.getCustomSqlSegment}

    </select>
    <select id="queryChatHistoryOfTheChannel" resultMap="MsgRecordOneSimpleUser">
        select <include refid="sql1" /> ${ew.getCustomSqlSegment}
    </select>
    <select id="selectVoByIdUser" resultMap="MsgRecordOneSimpleUser">
        select <include refid="sql1" /> where imr.id = #{id}
    </select>

</mapper>
